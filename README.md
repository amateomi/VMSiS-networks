## 1. Понятие системного администрирования

Системное администрирование решает задачи связанные с созданием и поддержанием
работоспособности информационных систем, состоящих из аппаратных и программных средств.

Сетевое администрирование неотделимо от администрирования. Им занимается системный
администратор.

Стратегии администрирования:
- Распределенное (нет единого центра регламентирующего политику администрирования)
- Централизованное (есть единый центр регламентирующий политику администрирования)

## 2. Выбор программного обеспечения администратором

Классификация ПО:
- Системное (напрямую взаимодействует с ОС для решения низкоуровневых задач) (непосредственно ОС и её компоненты, утилиты, субд)
- Прикладное (решает прикладные задачи пользователей) (веб-сайты, офисы)
- Инструментальное (способствует разработке и тестированию другого ПО)
- Встраиваемое (управляет устройством) (firmware)

По отношению к ОС ПО делят на:
- Native (от того же разработчика)
- Third party (от других разработчиков)

Критерии выбора:
- Степень соответствия требованиям
- Стоимость (приобретения, освоения, использования)
- Доступность (сложность приобретения и освоения)
- Эргономичность (сложность использования)
- Качество технической поддержки

## 3. Установка программного обеспечения администратором

Способы установки ПО:
- Ручное копирование исполняемых и вспомогательных файлов
- Ручная проверка зависимостей и сборка приложения из исходного кода
- Через пакетный менеджер (активно используется в Linux)
- Через установщик (активно используется в Windows)

Классификация сборок ПО:
- Development/pre-alpha/nightly (текущая)
- Alpha
- Beta
- Release candidate (прошла несколько этапов тестирования и рассматривается как возможный релиз)
- Release to manufacturing (промежуточный либо окончательный релиз)
- Final (окончательный релиз, после которого разработка считается завершенной)

## 4. Сопровождение программного обеспечения администратором

Сопровождение ПО - это одна из фаз жизненного цикла программного обеспечения,
следующая за фазой передачи ПО в эксплуатацию. В ходе сопровождения в программу
вносятся изменения с целью повысить удобство использования и применимость ПО.

С точки зрения системного администратора сопровождение ПО заключается в его обновлении
и устранении неисправностей.

Стратегии устранения неисправностей:
- Сверху вниз (начинать с прикладного уровня и спускаться вплоть до физического)
- Снизу вверх (начинать с физического уровня и подниматься на прикладной)
- Разделяй и властвуй (начинать с наиболее вероятного уровня и продолжать искать в двух направлениях)

## 5. Маршрутизаторы Cisco как специализированное сетевое оборудование

Категории маршрутизаторов Cisco:
- Branch
- WAN aggregation
- Service provider
- Industrial
- Virtual
- Small business

В сегментах small-to-medium businesses (SMB) и small office/home office (SOHO),
преобладают маршрутизаторы серий Integrated Services Routers (ISR). В
частности, их же принято использовать при обучении, на них ориентируется
программа CCNA.

Многие серии представляют собой гибриды с коммутаторами (Nexus).

## 6. Модули маршрутизаторов Cisco

Маршрутизаторы Cisco разрабатывают модульными, с возможностью установить
различные модули на специальное шасси.

Выделяют 5 групп модулей:
- Интерфейсные карты (WIC - WAN Interface Card, HWIC - High-speed WIC, EHWIC - Enhanced HWIC)
- Интерфейсные модули (NIM - Network Interface Module, NM - Network Module, NMD - NM Double-wide, NME - NM Enhanced)
- Внутренние модули (AIM - Advanced Integration Module, ISM - Internal Services Module)
- DSP-сопроцессоры
- Порт-адаптеры и другие модули для высокопроизводительных платформ

В названии модуля отражено его наполнение (HWIC-2FE добавляет 2 интерфейса Fast Ethernet).

## 7. Учебные маршрутизаторы Cisco

Для первоначального обучения администрированию маршрутизаторов Cisco
используются младшие модели ISR для сегмента SMB и старшие для сегмента SOHO.

Применительно к ISR - 1841, 2811, у ISR G2 - 1941, 2901, ISR 4K - 4331, 4221

Сетевое устройство можно рассматривать в 3 плоскостях:
1. Management (весь инструментарий для управления и отладки маршрутизатора, например, SSH)
2. Data (всё необходимое для пересылки трафика, например, таблица маршрутизации)
3. Control (служебная надстройка над данными, используется для коммуникации с другими сетевыми устройствами, например, OSPF)

Могут выделяться и другие плоскости. Плоскости могут быть разделены не только
программно, но и аппаратно (отдельные ядра или процессоры).

## 8. Структура маршрутизаторов Cisco

Структура маршрутизатора:
- Процессор
- Память
- Устройства ввода-вывода

В большинстве случаев используют процессоры на базе RISC архитектур, в
особенности MIPS. В более производительных маршрутизаторах применяются
ASIC (Application-specific integrated circuit).

Подсистемы памяти:
1. BootROM (ПЗУ хранящее загрузчик ROMMON)
2. NV-RAM (энергонезависимое ОЗУ для хранения конфигурации)
3. Flash (ПЗУ для хранения образов IOS, может хранить пользовательские файлы)
4. DRAM (обычное ОЗУ хранящее запущенную IOS и все необходимые для неё данные)

Устройства ввода-вывода в первую очередь реализуют сетевые интерфейсы.
Поддерживается подключение различных flash-устройств.

## 9. Cisco IOS как встраиваемая операционная система

Cisco Internetwork Operating System относится к специализированным
встраиваемым ОС. Главной задачей IOS является предоставление возможностей
конфигурирования маршрутизаторов и коммутаторов Cisco.

Линейки IOS:
- IOS XE
- IOS XR
- NX-OS

На сегодняшний день IOS XE является основной ОС, базируется на ядре Linux.

Средства для взаимодействия с IOS:
- CLI
- Веб-интерфейс
- ПО для устройств с DNA (Digital Network Architecture)

Для работы с CLI необходимо осуществить физическое подключение консоли 
через RS-232, более новые модели маршрутизаторов поддерживают подключение
по USB.

До недавнего времени CLI был основным способом конфигурирования IOS, однако
в последние годы активно продвигается централизованное конфигурирование
на базе DNA по средствам веб-интерфейса.

## 10. Загрузка IOS

Загрузка состоит из следующих этапов:
1. bootstrap выполняет POST (Power-On Self-Test) и инициализирует аппаратные структуры и подсистемы, а также программные структуры загрузочной среды, например, переменные окружения
2. bootstrap ищет образ IOS по специальной строке в конфигурации либо по значению переменной BOOT. Если не нашел, то поиск продолжается в подсистеме Flash памяти, выбирая первый попавшийся. Если образов не найдено, то запускается интерпретатор командной строки ROMMON, позволяющий скопировать образ в Flash.
3. Образ IOS загружается в DRAM и инициализирует все необходимые программные и аппаратные структуры
4. Если загрузочная конфигурация отсутствует, то будет выведено предложение о начале конфигурационного диалога, в случае отказа будет выбрана конфигурация по умолчанию. В конце выведется сообщение, предлагающее начать работу, при согласии произойдет копирование загрузочной конфигурации либо ранее настроенной в рабочую конфигурацию. Появится приглашение командной строки (prompt)

## 11. Режимы IOS

Основные режимы IOS:
1. Пользовательский исполнительский (просмотр состояния системы и проверка связи)\
   Приглашение: `Device>`
2. Привилегированный исполнительский (просмотр конфигурации, работа с файлами, перезагрузка)\
   Приглашение: `Device#`\
   Для перехода: `Device> enable`
3. Глобальный конфигурационный (конфигурирование устройства в целом)\
   Приглашение: `Device(config)#`\
   Для перехода: `Device# configure terminal`
4. Конфигурирования интерфейса (конфигурирование отдельного интерфейса)\
   Приглашение: `Device(config-if)#`\
   Для перехода: `Device(config)# interface <какой-либо интерфейс>`
5. Конфигурирования линии (конфигурирование отдельной линии)\
   Приглашение: `Device(config-line)#`\
   Для перехода: `Device(config)# line <какая-либо линия>`
6. ПЗУ-монитор (диагностика и восстановление)\
   Переход осуществляется прерыванием загрузки IOS

## 12. Система команд IOS и ее особенности

Большинство команд требуют наличия аргументов. Почти всегда IOS не различает
строчные и прописные буквы при вводе команд (исключение, например, пароли).

У каждого режима свои команды. Из режимов конфигурирования можно выполнить
команды исполнительских режимов путем добавления `do` в начале.

С помощью команды `?` можно запросить список доступных команд либо варианты
подстановки аргументов в уже начатой команде. Часть команд скрыта (нерекомендуемые).

Некоторые команды можно инвертировать используя префикс `no`, например,
убрать ip адрес с интерфейса можно добавив `no` в начале той команды,
которая этот ip адрес установила.

CLI IOS поддерживает сокращение команд по названию, например, вместо
`configure terminal` можно написать `conf t`.

## 13. Файлы конфигурации и файловая система IOS

В Cisco IOS можно выделить два файла конфигурации:
- running-config (содержит текущую конфигурацию запущенного устройства)
- startup-config (содержит конфигурацию применяемую при запуске устройства в качестве running-config)

Файлы конфигурации состоят из секций, состоящих по большей части из команд.
Если строка в конфигурации начинается с `!`, то эта строка игнорируется
IOS (можно использовать для комментариев).

В IOS используется специальная файловая система IFS (IOS File System). В её
основе лежит FAT16 (обычная IOS) и ext2 (IOS XE). IFS включает 3 подсистемы:
- network file systems
- special file systems
- storage file systems

Для обращения к локальным или удаленным файловым ресурсам используют
специальные префиксы. Рабочим каталогом по умолчанию является `flash:`.

Основные команды для работы с файлами:
- cd (сменить каталог)
- pwd (вывести на экран название текущего каталога)
- more (вывести на экран содержимое файла)
- dir (вывести на экран содержимое текущего каталога)
- copy (скопировать файл либо каталог)
- rename (переименовать файл либо каталог)
- delete (удалить файл)
- rmdir (удалить каталог)
- mkdir (создать каталог)
- erase (удалить все файлы и каталоги из файловой системы)
- format (отформатировать файловую систему)

## 14. Основные команды IOS для базовой настройки маршрутизатора и просмотра его состояния

К базовой настройке маршрутизатора можно отнести задание правильного времени,
названия хоста и пароля.

Для работы со временем используются команды `clock` и `calendar` в 
привилегированном режиме. Команда `clock` взаимодействует с программными
часами, а `calendar` - с аппаратными. Предпочтительней использовать
программные часы, они более точны, могут обновлять свое состояние по
протоколу NTP.

Название хоста можно изменить командой `hostname` в режиме конфигурации.
По умолчанию маршрутизаторы Cisco именуются Router.

Настройка пароля осуществляется с помощью команды `enable secret <пароль>`
в режиме конфигурации.

Просмотр состояния различных подсистем IOS осуществляется с помощью команды
`show` с различными аргументами:
- running-config/startup-config (соответствующая конфигурация)
- interfaces (подробное состояние всех сетевых интерфейсов, или некоторого конкретного, если передан соответсвующий аргумент)
- line (подробное состояние всех линий, или некоторой конкретной, если передан соответсвующий аргумент)
- version (общая информация об IOS и маршрутизаторе)
- processes (подробная информация об процессах)

## 15. Сетевые интерфейсы в IOS

Cisco разделяет конфигурируемые сетевые интерфейсы на L2 и L3.

На гибридных маршрутизаторах имеется возможность преобразовать L2 и L3
интерфейсы друг в друга с помощью команд `switchport` и `no switchport`.

Сетевые интерфейсы коммутаторов по умолчанию L2 и административно включены,
а маршрутизаторов - L3 и административно выключены.

Cisco Loopback - программный L3-интерфейс использующийся для отладки.

Cisco Null - программный L3-интерфейс использующийся для устранения
маршрутизационных циклов. Не принимает и не передает пакеты.

Именование сетевых интерфейсов:
- маршрутизаторы: type slot/subslot/port
- коммутаторы: type switch/slot/port

Основные типы: Ethernet, FastEthernet, GigabitEthernet, TenGigabitEthernet,
Serial.

Сетевые интерфейсы, предназначенные для подключения терминалов, Cisco
называет линиями (lines).

## 16. Сетевые интерфейсы и подсети

Логически Internet состоит из множества подсетей.

Подсеть (subnet) - адресное пространство, в котором имеется некоторое
количество устройств. Минимально подсеть соответствует сегменту.

Критерии объединения станций в подсети:
- Расположение
- Назначение
- Принадлежность

Типы станций:
- пользовательские (за ними работают обычные пользователи сети)
- шлюзы (объединяют подсети)

Сетевой интерфейс - минимально адресуемый компонент в сети передачи данных,
входящий в состав станции. Станция может содержать несколько сетевых
интерфейсов (обычно пользовательская содержит один, а шлюзовая - минимум два).
Обычно сетевой интерфейс имеет только один физический порт. Каждый сетевой
интерфейс имеет свой IP-адрес (не все IP-адреса разрешены).

## 17. Классы IPv4-адресов

Выделяют 5 классов IP-адресов: A, B, C являются основными, классы D и E -
дополнительными. Класс D используется для адресации мультикаст-групп. Класс E
зарезервирован для будущего использования.

Любой IP-адрес состоит из подсетевой (subnet) и станционной (node) частей.

*S - Subnet, N - Node*

### A:
Первый байт: 0xxx_xxxx\
Формат адреса: S.N.N.N
### B:
Первый байт: 10xx_xxxx\
Формат адреса: S.S.N.N
### C:
Первый байт: 110x_xxxx\
Формат адреса: S.S.S.N
### D:
Первый байт: 1110_xxxx
### E:
Первый байт: 1111_0xxx

## 18. Явные IPv4-параметры сетевого интерфейса

Явные IP-параметры сетевого интерфейса:
- IP Address
- Subnet Mask
- Default Gateway
- DNS Server

### IP Address
Служит для адресации станции посредством соответствующего сетевого интерфейса.
Уникальный в пределах подсети.

### Subnet Mask
Предназначена для определения адреса подсети и её размера исходя из IP-адреса.

В двоичном виде представляет собой непрерывную последовательность единиц и
следующую за ней непрерывную последовательность нулей. Единицы соответствуют
подсетевой части, а нули - стационарной.

Пример маски класса C: `255.255.255.0`. В нотации CIDR (Classless Inter-Domain
Routing) эта маска будет выглядеть так: `/24`.

### Default Gateway
Шлюз по умолчанию - адрес сетевого интерфейса из текущей подсети, на который
будут направляться пакеты направленные в другие подсети в том случае, когда
остальные маршруты не подошли.

Принято в качестве шлюза по умолчанию назначать адрес первого сетевого
интерфейса в подсети. Принято в пределах подсети использовать только один
шлюз по умолчанию.

### DNS Server
Адрес DNS-сервера необходим для обращения к службе DNS, позволяющей
восстановить цифровое значение адреса станции-абонента исходя из символьного.

## 19. Неявные IPv4-параметры сетевого интерфейса

Определение явных IP-параметров подразумевает задание ещё двух неявных:
- Subnet Address
- Broadcast Address

### Subnet Address
Используется для поочередной адресации всех возможных станций подсети.
Адрес подсети всегда самый нижний адрес подсети из из диапазона адресов
подсети.

### Broadcast Address
Широковещательный адрес используется для одновременной адресации всех
возможных станций подсети. Широковещательный адрес всегда самый верхний адрес
из диапазона адресов подсети.

Пример: устройство с IP-адресом `192.168.0.13/24`:
- Subnet Address `192.168.0.0`
- Broadcast Address `192.168.0.255`

Таким образом в каждой подсети всегда два адреса зарезервировано, а значит
маску 255.255.255.254 практического смысла использовать не имеет.

## 20. Классификация IPv4-адресов

По видимости:
- Публичные
- Приватные (видны только во внутренней сети предприятия или организации)

Для внутренних подсетей зарезервированы следующие диапазоны адресов:
- A: 10.x.x.x
- B: 172.16.0.0 - 172.31.255.255
- C: 192.168.x.x

По временному постоянству:
- Статические (устанавливается администратором вручную)
- Динамические (присваивается станции в процессе загрузки на время сеанса работы).

Динамический адрес может назначаться по определенному протоколу (например,
DHCP), а может случайно генерироваться (адреса Link Local 169.254.x.x).

0.0.0.0 - адрес всей глобальной сети Internet (имеет другие значения в
зависимости от контекста).

255.255.255.255 - глобальный широковещательный адрес (однако на сегодняшний
день шлюзы его подавляют).

127.0.0.1 - адрес интерфейса-заглушки. Пакеты с такими адресами назначения
передаются на прикладной уровень этой же станции.

## 21. Использование адресного пространства IPv4 и «правила хорошего тона»

При создании новых подсетей выделяют следующие стратегии:
- Новую подсеть включают в существующую бОльшую подсеть
- Новую подсеть добавляют к существующей как смежную

Первая стратегия целесообразна для разноранговых подсетей, вторая - для
одноранговых (может применяться с VLSM (Variable-Length Subnet Masking)).
Желательно иметь резерв адресов.

Правилами хорошего тона называется негласный набор подходов и практик,
относящихся к тем или иным действиям. Например, в программировании правилом
хорошего тона можно назвать именование функций глаголами. В сетевом
администрировании к правилам хорошего тона можно отнести следующие подходы:
- Шлюзу по умолчанию следует присваивать первый адрес подсети (не считая сам адрес подсети)
- В каждой подсети не должно быть несколько шлюзов по умолчанию

## 22. Статическая IPv4-адресация в Windows

В Windows 10 есть несколько основных способов для просмотра и изменения
IP-адресов сетевых интерфейсов.

### Графический
1. Открыть `Settings`
2. Выбрать `Network & Internet`
3. Перейти на вкладку `Wi-Fi`
4. Выбрать сеть для настройки
5. В самом низу можно ознакомиться с соответствующими параметрами сетевого интерфейса
6. При нажатии на кнопку `Edit` можно настроить статический IPv4-адрес

### Консольный (cmd)
Для просмотра и IP-адресации можно использовать утилиту ipconfig, а для настройки -
netsh.

Для проверки связи может использоваться утилита ping.

## 23. Статическая IPv4-адресация в Linux

Для просмотра текущих параметров сетевых интерфейсов используются утилиты
ifconfig и ip. Они также позволяют менять параметры на лету, но эти изменения
пропадут после перезагрузки.

Чтобы выставить статический IPv4 адрес в дистрибутиве Debian используется файл
`/etc/network/interfaces`, в котором для обозначенного интерфейса указываются
адрес, маска, шлюз по умолчанию и DNS-сервер.

В обычных обстоятельствах вручную настраивать IP-адресацию не требуется, ядро
Linux распознает основные виды сетевых адаптеров и само все настраивает, в
некоторых случаях может понадобиться установка драйверов.

Для проверки связи может использоваться утилита ping.

## 24. Статическая IPv4-адресация в IOS

Для назначения IP-адреса сетевому интерфейсу используют команду `ip address`.

Для административного включения сетевого интерфейса используют команду `no
shutdown`.

Для вывода на экран IP-информации о сетевом интерфейсе либо сетевых
интерфейсах используют команду `show ip interface brief`. При чем часть `brief`
не обязательна, она служит для упрощения вывода.

Для указания адреса DNS-сервера используют команду `ip name-server`.

Для проверки связи используют команды ping и traceroute. Они могут
сработать не сразу, а спустя пару попыток, это нормально для маршрутизаторов
Cisco.

## 25. Структура сети передачи данных

Структурные элементы сети передачи данных:
- Канал (link) (СрПД, через которую передаются пакеты)
- Узел (node) (устройство, выполняющее прием, передачу или ретрансляцию пакетов)

Узлы делят на:
- Пассивные (не выполняет анализ или обработку пакетов)
- Активные (пакеты анализируются или обрабатываются)

С точки зрения модели OSI узлы делятся на:
- Повторители (концентраторы) (аппаратно сращивают СПД на физическом уровне)
- Мосты (коммутаторы) (аппаратно (чаще всего) сращивают СПД на канальном уровне)
- Шлюзы (маршрутизаторы) (аппаратно и программно сращивают СПД на сетевом уровне)

Физические порты маршрутизаторов ограничивают широковещательные домены.

Физические порты коммутаторов ограничивают домены коллизий.

## 26. Понятие маршрута и классификация маршрутов

Маршрут - путь, по которому пакет передается от станции-отправителя к
станции-получателю или составная часть этого пути.

Маршрутизация - процесс определения маршрута для передачи данных. Таким
образом маршруты определяются при маршрутизации (статической или динамической).

Виды маршрутов:
- до станции (сетевого интерфейса)
- до подсети
- по умолчанию

Маршруты хранятся в таблице маршрутизации.

## 27. Обобщенная структура таблицы маршрутизации

Таблица маршрутизации используется для хранения маршрутов.

| Destination                                                                                                             | Netmask                                                                                                                                                                              | Gateway                                                                                                         | Interface                                                                                                                | Metric                             | Options                               |
|-------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------|------------------------------------|---------------------------------------|
| IP-адрес, определяющий вид маршрута (до станции, до подсети, по умолчанию). Адрес 0.0.0.0 означает маршрут по умолчанию | Дополняет адрес назначения с целью его правильной интерпретации (если не указана, то подставляется стандартная). Маска 255.255.255.255 означает маршрут к одному сетевому интерфейсу | IP-адрес шлюза-соседа, которому нужно передать пакет (если пакет не покидает пределы подсети, то шлюз не нужен) | IP-адрес или другой параметр, однозначно определяющий сетевой интерфейс, который должен физически «выдать» пакет в канал | Определяет приоритетность маршрута | Специфические опции данной реализации |

## 28. Алгоритм применения таблицы маршрутизации для передачи пакета

В настоящее время применяется подход best match:
1. Последовательно проверяется вхождение IP-адреса назначения в диапазон адресов соответствующего маршрута с учетом маски
2. При попадании маршрут считается подходящим
3. После первого попадания проверка продолжается в оставшейся части таблицы
4. При наличии нескольких попаданий выбирается наиболее точное (самое точное - маршрут к сетевому интерфейсу)
5. При одинаковой точности маршрут выбирается исходя из метрики
6. При одинаковой метрике в разных реализациях могут применяться различные алгоритмы балансировки нагрузки, так или иначе будет выдано предпочтении одному из маршрутов (в некоторых реализациях совпадение метрик недопустимо)
7. Если попаданий не обнаружено, то выбирается маршрут по умолчанию. Если маршрут по умолчанию не задан, то пакет отбрасывается
8. После нахождения маршрута пакет один раз отправляется по указанному в таблице маршрутизации интерфейсу

## 29. Структура Internet

Автономные системы (Autonomous Systems) - основные структурные единицы Internet.
Каждая AS имеет собственную систему маршрутизации и не зависит от других AS.

Внутри AS работают провайдеры (ISP).

Все AS имеют уникальные 16-битные номера, поделенные на публичные и приватные.

AS связаны между собой посредством базовых магистралей (backbones). Изначально
задумывалась только одна магистраль, но на практике не всегда получалось
осуществить непосредственное примыкание AS к базовой магистрали.

Реально AS соединены друг с другом через точки присутствия (Points-Of-Presence).

## 30. Назначение и классификация протоколов динамической маршрутизации

Главной задачей динамической маршрутизации является передача между узлами 
маршрутов к подсетям с целью нахождения абонентов и оптимизации трафика.

Большие сети разбиты на подсети для уменьшения размеров таблиц маршрутизации
тем самым упрощая сам процесс маршрутизации.

Основные алгоритмы динамической маршрутизации:
- По вектору расстояний (DVA) (опираются на таблицы, поддерживаемые всеми маршрутизаторами и содержащие сведения о кратчайших известных путях к каждому из возможных адресатов и о том, какое соединение следует при этом использовать. Для обновления данных этих таблиц производиться обмен информацией с соседними маршрутизаторами. Базовым является алгоритм Беллмана-Форда)
- С учетом состояния линий (LSA) (основаны на хранении всей топологии сети в каждом маршрутизаторе для последующего использования алгоритма Дийкстры для расчета кратчайшего маршрута. Информацию об обновлении в топологии предполагается пересылать в специальных служебных пакетах)

Протоколы для внутренних шлюзов называются IGP (Interior Gateway Protocols),
а для внешних - EGP (Exterior Gateway Protocols).

Таблица актуальных протоколов:

|     | IGP            | EGP |
|-----|----------------|-----|
| DVA | RIP            | BGP |
| LSA | OSPF<br/>IS-IS | -   |

## 31. Последовательность действий при передаче пакета в подсети и пересылка транзитных пакетов

Последовательность действий при передаче пакета в некоторой подсети:
1. IP-пакет на исходной станции передается на канальный уровень (например, инкапсулируясь в кадр Ethernet)
2. Если MAC-адрес назначения не известен, то он будет восстановлен по протоколу ARP. Обычно ядра ОС имеют таблицу соответствий IP к MAC-адресам
3. Если пакет предназначался станции этой подсети, то происходит передача кадра в подсеть с последующим получением этого кадра всеми станциями подсети
4. Если MAC-адрес станции совпадет с MAC-адресом назначения, то произойдет деинкапсуляция кадра и передача пакета на сетевой уровень для последующей обработки. Остальные станции по-хорошему отбросят этот кадр
5. Если пакет предназначен станции в другой подсети, то он будет передан согласно таблице маршрутизации (возможно с повторением пункта `2` для шлюза)

Чтобы обеспечить передачу транзитных пакетов между подсетями через шлюз на
нем должен быть включен IP forwarding, который позволит ретранслировать пакеты
с одного сетевого интерфейса на другой.

## 32. Структура таблицы ARP

ARP таблица хранит соответсвующее IP и MAC адреса.

Типы строк ARP таблицы:
- Статические (вносятся администратором и хранятся до перезагрузки или ручного удаления)
- Динамические (вносятся ядром ОС и хранятся некоторый промежуток времени)

Типичная строка ARP таблицы:

| IP-адрес | MAC-адрес | Тип |
|----------|-----------|-----|

## 33. Использование протокола ARP

ARP (Address Resolution Protocol) - протокол сетевого уровня модели OSI,
используется для получения MAC-адреса по IP-адресу.

В ARP имеется 2 основных типа пакета: request и response, использующиеся для
запроса MAC-адреса и для ответа на этот запрос соответственно. Также есть
вспомогательные probe и announcement, использующиеся для проверки на занятость
IP-адреса при подключении нового сетевого интерфейса: инициирующая станция
спрашивает в подсети не занят ли некоторый IP-адрес и если не занят, то
анонсирует подсети, что этот IP-адрес теперь зарезервирован.

Ядра сетевых ОС имеют ARP таблицы, чтобы не совершать ARP Request каждый раз,
когда необходимо переслать IP пакет.

Сегменты с топологий point-to-point не используют ARP за ненадобностью т.к.
не имеют MAC адресов.

## 34. Практические особенности IPv4-маршрутизации

*Накидать все что знаешь по IPv4-маршрутизации + правила хорошего тона.*

## 35. Структура таблицы IPv4-маршрутизации в Windows

Чтобы просмотреть текущую таблицу маршрутизации в Windows используют команду
`route print`.

В таблице имеются стандартные колонки Network Destination, Netmask, Gateway,
Interface и Metric.

Также указаны Persistent Routes, они сохраняются при перезагрузке системы.

Gateway может иметь значение `On-link`, означающее, что адрес назначения
находится в той же подсети, что и ПК.

В качестве значения для поля Interface используются IP-адреса сетевых
интерфейсов.

## 36. Структура таблицы IPv4-маршрутизации в Linux

Чтобы просмотреть текущую таблицу маршрутизации в Linux используют команду
`netstat -r`.

В таблице имеются стандартные колонки Destination, Gateway, Genmask и Iface.
Также имеются колонки Flags (U - route is Up, G- use Gateway) и MSS, Window,
irtt - устаревшие параметры TCP.

В качестве значения для поля Iface используются символьные названия сетевых
интерфейсов (например, eth0 или wlp2s0).

## 37. Структура таблицы IPv4-маршрутизации в IOS

Чтобы просмотреть текущую таблицу маршрутизации в Cisco IOS используют команду
`show ip route`.

Маршруты делят на:
- Directly connected (C) маршруты к своим подсетям
- Static (S)
- Dynamic (R, B, O)
- Local (L) к своим сетевым интерфейсам

Таблица маршрутизации в IOS иерархична и имеет два уровня: L1 и L2. Иерархия
необходима для ускорения обработки таблицы маршрутизации.

В строке таблицы имеется информация по адресу назначения с его маской, адрес
шлюза, использующийся интерфейс для передачи пакета, в квадратных скобках
указывается административная дистанция и метрика, может присутствовать и
другая информация.

## 38. Статическая IPv4-маршрутизация в Windows, Linux и IOS

Для добавления статического маршрута и в Windows и в Linux можно использовать
команду `route add`. Однако это не одна и та же утилита, а следовательно
порядок и название аргументов для совершения необходимой операции на системах
разный. В общем случае необходимо указывать адрес назначения, его маску и
адрес шлюза.

При добавлении флага `-p` команде на Windows можно добиться постоянства этого
статического маршрута. В Linux дистрибутивах этого можно добиться разными
путями.

В IOS статический маршрут прописывается через команду `ip route <destination> <mask> <gateway>`.

## 39. Структура системы удаленной загрузки

Удаленная загрузка - загрузка ядра ОС на станции не с локального накопителя
(например, HHD), а с накопителя на некоторой удаленной станции.

Структурно в удаленной станции можно выделить 2 элемента:
- Booted node (загружаемая станция)
- Booting node (загружающая станция)

Удаленная загрузка обычно осуществляется на бездисковых пользовательских
станциях (stateless) не предназначенных для хранения информации. Для решения
проблемы отсутствия локального диска используются 2 подхода:
- Виртуальный диск в оперативной памяти
- Сетевой виртуальный диск

## 40. Технологии удаленной загрузки

Удаленная загрузка - загрузка ядра ОС на станции не с локального накопителя
(например, HHD), а с накопителя на некоторой удаленной станции.

Для различных протоколов сетевого уровня имеется свой набор технологий для
удаленной загрузки:
- IPX: Remote Program Load (RPL) с ПО от Microsoft
- IPv4: стек протоколов BOOTstrap Protocol (BOOTP) -> Dynamic Host Configuration Protocol (DHCP) -> Preboot eXecution Environment (PXE) с соответствующим ПО
- IPv6: стек протоколов DHCPv6 -> Netboot6 (PXE на базе IPv6) с ПО от Microsoft
- IPv4/IPv6: технологии сетевого хранилища Internet Small Computer Systems Interface (iSCSI) и (Fibre Channel over Ethernet) FCoE вместе со специальным ПО
- IPv4/IPv6: HTTP Boot и ПО от HP и IBM

Для IPv4 и IPv6 также есть множество других протоколов и необходимого
свободного ПО.

## 41. Поддержка удаленной загрузки в BIOS

BIOS (Basic Input/Output System) - набор микропрограмм, реализующих
низкоуровневые API для работы с аппаратным обеспечением компьютера и
осуществляющий инициализацию аппаратуры во время запуска. Работает в реальном
режиме процессора с 16-битной адресацией.

В BIOS имеется возможность интеграции сторонних расширений - add-on BIOSes.
Для обеспечения удаленной загрузки используется расширение boot ROM,
ориентированный на IPv4.

Этапы удаленной загрузки в BIOS после запуска устройства:
1. Во время POST (Power On Self Test) BIOS сканирует специальный участок памяти, в который отображаются все расширения, в поисках сигнатуры - двух последовательных байтов 55h и AAh
2. Если сигнатура найдена, то третий байт хранит размер модуля в 512-битных страницах
3. Чтобы проверить целостность расширения, происходит суммирование его байтов по модулю 100h. Последний байт содержит контрольную сумму, таким образом остаток 0 указывает, что расширение BIOS содержит корректный код
4. Передается управление коду начиная с четвертого байта расширения, применительно к boot ROM этот код переопределяет обработчик прерывания 18h
5. После конца сканирования участка памяти с расширениями BIOS вызывается прерывание 18h
6. Происходит копирование в ОЗУ кода загрузчика boot ROM и ему передается управление
7. Загрузчик boot ROM получает код загрузчика bootstrap по сети, загружает его в ОЗУ и передает управление
8. Дальнейшие действия зависят от реализации

## 42. Поддержка удаленной загрузки в UEFI

UEFI (Unified Extensible Firmware Interface) - усовершенствованный аналог BIOS.
Можно даже назвать небольшой операционной системой. В отличие от BIOS работает
в защищенном 32 или 64-битном режиме.

По аналогии с add-on BIOS у UEFI имеется специальный интерфейс для расширения
функциональности - UEFI API. В рамках которого можно выделить Universal Network
Driver Interface (UNDI), предоставляющий интерфейс для написания сетевых
драйверов, в том числе и для удаленной загрузки.

Типичные UEFI ориентированны на IPv4/IPv6 и поддерживают протоколы:
- PXE
- Netboot6
- iSCSI Boot
- FCoE Boot
- HTTP Boot

## 43. Взаимодействие по протоколу PXE

PXE (Preboot eXecution Environment) представляет из себя надстройку над DHCP,
формализующую три вещи:
1. Протокол взаимодействия клиентской станции с сервисами адресации и загрузки
2. Набор API, образующие загрузочную среду для клиентской станции
3. Структуру boot ROM

В качестве транспорта используется UDP. Стандартный порт на стороне
DHCP-сервера - 67, на стороне DHCP-клиента - 68, на стороне TFTP-сервера - 69.

Взаимодействие по протоколу PXE состоит из следующих этапов:
1. DHCPDISCOVER: DHCP-клиент посылает широковещательный запрос которым сообщает сети, что находится в поиске DHCP-сервера
2. DHCPOFFER: DHCP-сервер выделяет и посылает IP-адрес DHCP-клиенту
3. DHCPREQUEST: DHCP-клиент запрашивает некоторые конфигурационные параметры и подтверждает назначенный IP-адрес, тем самым подтверждается выбор и соответствующего DHCP-сервера (ибо на этапе DHCPDISCOVER могло откликнуться несколько DHCP-серверов в сети)
4. DHCPACK: DHCP-сервер подтверждает подтверждение (пункт 3) и посылает DHCP-клиенту запрошенные конфигурационные параметры
5. Boot Service Discover: PXE-клиент посылает DHCPREQUEST с запросом о предоставлении загрузочного сервиса
6. Boot Service Ack: DHCP-сервер, находящийся на стороне загрузочного сервиса, подтверждает предоставление услуг посылая DHCPACK с указанием названия файла загрузчика bootstrap
7. Bootstrap Request: TFTP-клиент запрашивает файл загрузчика bootstrap
8. Bootstrap Download: TFTP-клиент скачивает файл загрузчика bootstrap
9. Bootstrap Exec: запускается загрузчик bootstrap

Если TFTP-сервер находится на той же станции, что и DHCP-сервер, то шаги 5 и 6
выполняться в рамках шагов 3 и 4.

## 44. Протоколы BOOTP, DHCP, TFTP и их использование

BOOTP (Bootstrap Protocol) - первый популярный протокол прикладного уровня
модели OSI, служащий для динамического назначения IP-адресов. В качестве его
альтернативы для нахождения IP-адреса по MAC-адресу можно использовать RARP.

DHCP (Dynamic Host Configuration Protocol) представляет собой расширение BOOTP.
Появилась возможность обновлять выданные IP-адреса и появился динамический пул
IP-адресов.

DHCP-заголовок имеет поле для IP-адреса, а также очень много полей в options.
Тип DHCP-сообщение определяется из значения DHCP Message Type. Основными
являются DHCPDISCOVER, DHCPOFFER, DHCPREQUEST и DHCPACK. По истечении времени
валидности IP-адрес обновляется посредством юникаст DHCPREQUEST и DHCPACK.

DHCP relay позволяет разместить DHCP-клиент и DHCP-сервер в разных сегментах.

TFTP (Trivial File Transfer Protocol) - упрощенная и менее надежная (UDP
вместо TCP) альтернатива FTP. Используется для передачи файлов (в основном
загрузчика bootstrap).

DHCP и TFTP используется в рамках PXE.

BOOTP, DHCP и TFTP в качестве транспорта использует UDP.

## 45? Поддержка удаленной загрузки в Windows и Linux

Для поддержки удаленной загрузки в качестве загружаемой необходимо иметь DHCP и
TFTP клиенты (если речь идет о PXE), а загружающей станции - DHCP и TFTP
серверы.

DHCP-клиент в Windows запускается автоматически и интерфейс для явного
конфигурирования не предусмотрен. TFTP-клиент в Windows присутствует, но по
умолчанию отключен, включить его можно как через командные строки cmd и
PowerShell, так и через стандартные графические интерфейсы. Серверные редакции
Windows имеют сервис DHCP, но сервис TFTP по умолчанию не имеется, однако можно
установить стороннее ПО.

DHCP-клиент в Linux дистрибутивах представлен демоном dhclient. В Debian для
его настройке можно использовать файл `/etc/dhcp/dhclient.conf`. TFTP-клиент
представлен в виде утилиты tftp. В качестве DHCP-сервера используется демон
dhcpd, его конфигурирование осуществляется через файл `/etc/dhcp/dhcpd.conf`,
а в качестве TFTP-сервера - демон tftpd, не имеющий файла с конфигурацией.

## 46. Динамическая IPv4-адресация в IOS

Динамическую IPv4-адресацию в Cisco IOS можно реализовать через DHCP. Протокол
DHCP подразумевает наличие DHCP-клиента и DHCP-сервиса.

DHCP-клиент запускается на каждом интерфейсе в отдельности используя команду
`ip address dhcp`. Перед ней можно настроить DHCP, например, установить время
валидности полученного IP-адреса используя команду `ip dhcp client lease <дни>
<часы> <минуты>`.

DHCP-сервис на маршрутизаторах Cisco по умолчанию запущен. Для остановки можно
использовать команду `no service dhcp`. Для просмотра различных параметров
DHCP-сервиса можно использовать семейство команд `show ip dhcp <ключевые слова>`.

## 47. Специальные соглашения при IPv4-адресации и IPv4-маршрутизации

*Накидать все что знаешь по IPv4-адресации и IPv4-маршрутизации + правила хорошего тона.*

## 48. Правила записи IPv6-адресов

В общем виде IPv6 адрес можно представить так:\
X:X:X:X:X:X:X:X\
где X - четыре шестнадцатеричных числа (2 байта).

Поскольку IPv6 адрес занимает в 4 раза больше битов чем адрес IPv4 в нем
применили несколько приемов для сокращения записи:
- Используется шестнадцатеричная система счисления
- В тетрадах можно опускать левые нули (`000F` -> `F`)
- последовательности из больше чем одного нуля можно не писать, оставив `::` на их месте (можно применить только один раз, ибо иначе невозможно было бы определить, сколько нулей пропущено в этих последовательностях)

## 49. IPv6-терминология в сравнении с IPv4-терминологией

В IPv6 нет механизма классов. Вместо них введено понятие адресных префиксов
(представляют собой некоторую последовательность в начале адреса).

Есть 3 базовых типа адресов:
- Юникаст
- Мультикаст
- Эникаст

В IPv6 нет Бродкаст-адресов.

Базовые типы делятся на различные виды. Каждый вид имеет свой особый адресный
префикс.

В отличие от IPv4 сетевые интерфейсы могут иметь несколько IPv6 адресов.
Адресов очень много и хватит на всю вселенную, так что можно назначать по
несколько для каждой задачи.

В IPv4 предусматривается только одна глобальная сеть, а в IPv6 предполагается
возможность построение нескольких независимых.

В IPv6 стандартизированны виды подсетей:
- Interface-local scope
- Link-local scope (подсеть размером в один сегмент)
- Realm-local scope
- Admin-local scope
- Site-local scope
- Organization-local scope
- Global scope

Заменой приватным адресам IPv4 в IPv6 являются локальные адреса, а публичным -
глобальные (Global Unicast).

В IPv4 узлы разделялись на пользовательские станции и шлюзы, в IPv6 узлы
разделяют на хосты и роутеры.

В IPv6 нет маски подсети, чтобы узнать размер подсети в IPv6 используют
префикс подсети. Например, `FD00:0:0:1::/64`, где 64 - число фиксированных битов.

## 50. Локальные IPv6-адреса типа юникаст

Заменой приватным адресам IPv4 в IPv6 являются локальные адреса.

Link-local Unicast имеет вид `FE80::/10` т.е. первые 10 бит это 1111_1110_1,
последующие 54 бита равны нулю, оставшиеся 64 бита - Interface ID.

Значение для Interface ID строится на базе MAC-адреса путем добавления в его
середину байтов `FF FE` и выставлением 6 бита (если считать с 0) в единицу.
Если у сетевого интерфейса нет MAC-адреса (например в топологиях Point-to-Point), то можно использовать какой-нибудь другой
уникальный идентификатор, например, чужой MAC-адрес или UUID роутера.

Пакеты с адресом Link-local Unicast не могут покинуть свой линк.

Для организации внутренней сетевой иерархии в какой-нибудь компании можно
использовать Unique Local Unicast. Он имеет вид `FC00::/7` т.е. первые 7 бит
это 1111_101, далее идет один бит 1 (значение 0 зарезервировано на будущие),
40 бит уникального глобального идентификатора, 16 бит для идентификации подсети
и 64 бита Interface ID (аналогично Link-local Unicast).

Также в соответствующих RFC упоминается Site-local Unicast, но на данный
момент они уже не используются.

## 51. Глобальные IPv6-адреса типа юникаст

Заменой публичным адресам IPv4 в IPv6 являются Global Unicast.

Global Unicast имеет вид `2000::/3` т.е. первые 3 бита это 001, далее идут 45
бит уникального глобального идентификатора, который выдают на сайт ISP, 16 бит
для идентификации подсети и 64 бита - Interface ID.

Стоит упомянуть, что размеры частей этого адреса не фиксированны, и в общем
случае RFC допускают произвольные размены m, n и 128 - m - n.

## 52. IPv6-адреса типа мультикаст и стандартные подсети

Мультикаст-адреса являются идентификатором для группы сетевых интерфейсов.
Сетевой интерфейс может принадлежать нескольким мультикаст-адресам.
Мультикаст-адреса могут присутствовать в пакетах только в поле Destination
Address.

Multicast имеет вид `ff00::/8` т.е. первые 8 бит равны единице, последующие 4
бита содержать некоторые флаги, 4 бита на scop (вид подсети), а все оставшиеся - 
идентификатор группы.

В поле scop закодированы следующие виды подсетей:
- 1: Interface-local scope
- 2: Link-local scope (подсеть размером в один сегмент)
- 3: Realm-local scope
- 4: Admin-local scope
- 5: Site-local scope
- 8: Organization-local scope
- E: Global scope

Заменой широковещательных адресов на уровне линка является Link-local All
Nodes Multicast (`ff02::1/128`), также можно упомянуть Link-local All Routers
Multicast (`FF02::2/128`).

## 53. IPv6-адреса типа эникаст

IPv6 эникаст-адрес назначается нескольким сетевым интерфейсам (зачастую на
разных узлах) с особенностью, что пакет, посланный на такой адрес, будет
маршрутизирован до ближайшего интерфейса.

Если присвоить одинаковый юникаст-адрес нескольким сетевым интерфейсам в подсети,
то этот адрес станет эникаст 🤡.

Эникаст-адрес строится на базе префикса подсети.

На практике используется только Subnet-router Anycast, где первые x бит
занимает префикс подсети, а все остальные биты равны 0. Их можно назначать
только сетевым интерфейсам маршрутизаторов и они могут присутствовать только в
соответствующих служебных пакетах, причем только в поле Destination Address.

## 54? Нотация EUI-64 и инкапсуляция IPv6-адресов типа мультикаст

Нотация EUI-64 может применяться в юникаст адресах в поле Interface ID.

Значение для Interface ID строится на базе MAC-адреса путем добавления в его
середину байтов `FF FE` и выставлением 6 бита (если считать с 0) в единицу.
Если у сетевого интерфейса нет MAC-адреса (например в топологиях Point-to-Point), то можно использовать какой-нибудь другой
уникальный идентификатор, например, чужой MAC-адрес или UUID роутера.

MAC-мультикаст адрес формируется на базе IPv6 мультикаст. Сначала идет два
байта `33 33`, а после - 32 младших бита IPv6 адреса.

## 55. Совместимость IPv6 с IPv4

Все IP-станции делят на:
- IPv4-only
- IPv6-only
- IPv6/IPv4
- IPv4 (IPv4-only либо IPv6/IPv4)
- IPv6 (IPv6-only либо IPv6/IPv4)

Для обеспечения совместимости с IPv4 стандартизированы следующие виды адресов:
- IPv4-Compatible (IPv4 адрес помещается в конец IPv6 адреса и все остальные биты выставлены в ноль)
- IPv4-Mapped (IPv4 адрес помещается в конец IPv6 адреса, перед ним 16 битов выставлены в единицу, а все остальные биты выставлены в ноль)
- 6to4 Unicast (первые 16 битов `2002`, дальше IPv4 адрес, 16 бит идентификатора подсети и 64 бита на идентификатор интерфейса. Предназначен для формирования автоматических туннелей)

В плане туннелирования на практике применяются IPv6-over-IPv4. Их делят на 3 типа:
- Host-to-host
- Host-to-router
- Router-to-router

В рамках стека протоколов TCP/IPv6 выделяют две архитектуры:
- Dual-layer (IPv4 и IPv6 разделены только на Internet-уровне модели TCP/IP)
- Dual-stack (стеки TCP/IPv4 и TCP/IPv6 полноценны и независимы)

## 56. Модели и задачи IPv6-автоконфигурирования

IPv6-автоконфигурация используется для динамической адресации.

Есть две модели:
- Stateless (SLAAC) (распределенное управление, адреса и другие параметры конфигурируются с помощью служебных сообщений, базируется на ICMPv6)
- Stateful (централизованное управление, адреса и другие параметры передаются по специально протоколу, базируется на DHCPv6)

Первая модель приоритетнее.

В рамках ICMPv6 (Internet Control Message Protocol) можно выделить:
- Neighbor Discovery (ND)
- Multicast Listener Discovery (MLD)

ND работает в рамках линка и в его задачи входят:
1. Router Discovery
2. Prefix Discovery
3. Parameter Discovery (например, maximum transmission unit (MTU) канального уровня, hop limit value сетевого уровня)
4. Address Autoconfiguration
5. Address resolution (речь о MAC-адресах, замена IPv4 ARP)
6. Next-hop determination
7. Neighbor Unreachability Detection
8. Duplicate Address Detection
9. Redirect (оптимизация маршрутов)

## 57. Обнаружение маршрутизаторов и оптимизация маршрутов при IPv6-автоконфигурировании

Обнаружение маршрутизаторов и оптимизация маршрутов являются первой и девятой
задачами, которые решает ND (Neighbor Discovery). ND работает в пределах линка.

ND определяет 5 типов ICMPv6 пакетов:
- Router Solicitation (RS)
- Router Advertisement (RA)
- Neighbor Solicitation (NS)
- Neighbor Advertisement (NA)
- Redirect

RA и Redirects могут передавать только маршрутизаторы.

Обнаружение маршрутизаторов осуществляется следующим образом: хост посылает
линк мультикаст RS пакет, ему отвечает маршрутизатор юникаст пакетом RA, тем
самым сообщая свой MAC и IPv6 адреса.

Оптимизация маршрутов осуществляется путем посылки Redirect пакетов, в которых
передается информация о более оптимальном первоначальном узле (first-hop node).

## 58? Восстановление параметров при IPv6-автоконфигурировании

Восстановление параметров является третьей задачей, которую решает ND
(Neighbor Discovery). ND работает в пределах линка.

Восстановление параметров происходит на узлах после получения соответствующего
Router Advertisement ICMPv6 пакета. К такого рода параметрам можно отнести
MTU (maximum transmission unit) и Cur Hop Count.

MTU обязательно должен быть указан в линках на базе вариативных размеров
кадров канального уровня (например, Ethernet).

Cur Hop Count - значение, которое будет вписываться в поле Hop Limit
заголовка IPv6 каждого передаваемого маршрутизатору пакета.

## 59. Автоконфигурирование адресов и их жизненный цикл при IPv6-автоконфигурировании

В контексте SLAAC под автоконфигурированием адресов понимают автоматическое
назначение сетевому интерфейсу юникаст-адресов (не считая Link-local Unicast).

Адрес формируется следующим образом: топологическая часть берется из
соответствующего поля RA пакета, а интерфейсная генерируется на базе EUI-64
нотации (гарантируется уникальность). При этом поддерживаться только префиксы
подсети длинной 64 бита.

Автоконфигурирование может происходить на сетевых интерфейсах как хостов, так
и роутеров.

Автоконфигурирование адресов подразумевает и автоматическое нахождение
маршрутизатора по умолчанию.

Адрес полученный в результате автоконфигурирования может быть в одном из
состояний:
1. Tentative (уникальность адреса ещё не проверена)
2. Preferred (адрес является предпочтительным)
3. Deprecated (использование адреса нежелательно)
4. Valid (адрес Preferred либо Deprecated)
5. Invalid (время жизни адреса истекло)

Промежуток времени, когда сгенерированный адрес является валидным,
контролируется двумя таймерами: Preferred Lifetime и Valid Lifetime.
Оба начинают свой отсчет сразу после получения адреса т.е. до проверки его на
уникальность.

## 60. Восстановление адресов при IPv6-автоконфигурировании и проверка конфликтов адресов

Восстановление адресов является пятой задачей, которую решает ND
(Neighbor Discovery). ND работает в пределах линка.

Под восстановлением адреса понимают получение MAC-адреса (замена IPv4 ARP).

### Алгоритм: 

Станция, которая хочет узнать MAC-адрес, посылает NS пакет по адресу
типа Solicited-node Multicast с опцией Target Address равной юникаст-адресу
станции назначения. Она в свою очередь отвечает пакетом NA с юникаст адресом,
в опциях которого и передается запрошенный MAC-адрес.

Почему вообще NS посылается по мультикаст-адресу? Все связано с незнанием
MAC-адреса станции назначения (мы его и пытаемся узнать), а значит на канальном
уровне приходится использовать мультикаст MAC-адрес. Solicited-node Multicast
используется вместо обычного линк мультикаст адреса в целях уменьшения
нагрузки на сеть.

Может предприниматься несколько попыток.

Алгоритм проверки конфликтов адресов подобен вышеописанному для восстановления
адресов. Но при посылке NS адрес источника опускается, если в сети найдется
узел с искомым адресом, то он пошлет соответсвующий мультикаст ответ NA. Если
NA не было, то искомый адрес в сети не занят.

## 61. Проверка достижимости при IPv6-автоконфигурировании

Проверка достижимости является седьмой задачей, которую решает ND
(Neighbor Discovery). ND работает в пределах линка.

Проверить достижимость сетевого интерфейса можно послав пакет NS с проверяемым
адресом назначения и дождавшись соответствующего ответа NA. Может
предприниматься несколько попыток (обычно три).

Алгоритм опирается на два основных таймера:
- Reachable Time (промежуток времени, в течении которого соответсвующий сетевой интерфейс считается доступным. По стандарту генерируется в промежутке от 15 до 45 секунд, чтобы избежать перегрузки сети синхронными запросами на достижимость)
- Retrans Time (интервал перед очередной попыткой проверки достижимости. По умолчанию равен одной секунде)

Значения для этих таймеров могут быть изменены при на соответствующие значения
полей RA пакетов.

## 62. Взаимодействие по протоколу Netboot6

Netboot6 - протокол удаленной загрузки для IPv6, аналог PXE в IPv4. Также
как и PXE использует TFTP и DHCP, но уже не DHCPv4, DHCPv6.

Взаимодействие по протоколу Netboot6 аналогично PXE и состоит из следующих этапов:
1. SOLICIT: DHCP-клиент посылает мультикаст запрос, которым сообщает линку, что находится в поиске DHCP-сервера
2. ADVERTISE: DHCP-сервер выделяет и посылает IP-адрес DHCP-клиенту
3. REQUEST: DHCP-клиент запрашивает некоторые конфигурационные параметры и подтверждает назначенный IP-адрес, тем самым подтверждается выбор и соответствующего DHCP-сервера (ибо на этапе SOLICIT могло откликнуться несколько DHCP-серверов в линке)
4. REPLY: DHCP-сервер подтверждает подтверждение (пункт 3) и посылает DHCP-клиенту запрошенные конфигурационные параметры
5. Boot Service Request: Netboot6-клиент посылает REQUEST с запросом о предоставлении загрузочного сервиса
6. Boot Service Reply: DHCP-сервер, находящийся на стороне загрузочного сервиса, подтверждает предоставление услуг посылая REPLY с указанием названия файла загрузчика bootstrap
7. Bootstrap Request: TFTP-клиент запрашивает файл загрузчика bootstrap
8. Bootstrap Download: TFTP-клиент скачивает файл загрузчика bootstrap
9. Bootstrap Exec: запускается загрузчик bootstrap

Если TFTP-сервер находится на той же станции, что и DHCP-сервер, то шаги 5 и 6
выполняться в рамках шагов 3 и 4.

Для обращения к DHCPv6-серверам и DHCPv6 relays стандартизированы два вида
мультикаст-адресов: Link-local All DHCP Relay Agents and Servers (`FF02::1:2`)
и Site-local All DHCP Servers (`FF05::1:3`).

## 63. Протокол DHCPv6 и его использование

DHCPv6 аналог DHCPv4 для IPv6. Однако по сравнению с DHCPv4, DHCPv6 имеет
смысл использовать только для получения параметров при удаленной загрузке т.к.
динамическая адресация реализуется автоконфигурированием.

Для обращения к DHCPv6-серверам и DHCPv6 relays стандартизированы два вида
мультикаст-адресов: Link-local All DHCP Relay Agents and Servers (`FF02::1:2`)
и Site-local All DHCP Servers (`FF05::1:3`).

DHCPv6 поддерживает транспорт TCP.

Стандартный порт для DHCPv6-клиента - UDP 546, а для DHCPv6 - UDP 547.

К основным типам сообщений можно отнести SOLICIT, ADVERTISE, REQUEST и REPLY,
именно они используются в Netboot6.

DHCPv6-сервер способен выдавать как постоянные (по аналогии с динамическими
адресами IPv4), так и врЕменные адреса. По аналогии с SLAAC постоянные адреса
имеют Valid Lifetime и Preferred Lifetime.

## 64. Проблемы при IPv6-маршрутизации и их решения

### Проблема Link-local unicast адресов
Пример: есть некоторый роутер с двумя сетевыми интерфейсами, по обе стороны
от интерфейсов есть хосты. У каждого сетевого интерфейса на роутере и на хостах
есть LLU адрес. Роутер пытается пингануть один из сетевых интерфейсов хостов
по их LLU адресам. Как ему определить в какой из своих сетевых интерфейсов
выдать пакет, если все сетевые интерфейсы имеет префикс подсети `FE80`?

Проблема решается явным указанием выходного сетевого интерфейса с помощью
идентификатора зоны.

![image](https://github.com/amateomi/aksis/assets/74430714/38938b20-0b1e-4a4a-9a4c-dbcd8e316711)

### Проблема выбора адреса источника
В IPv6 допускается (и активно применяется) использование нескольких IPv6 адресов
на одном сетевом интерфейсе. Как тогда определить, какой из них указывать в
качестве адреса источника когда пакет создан на этом узле?

Для решения этой проблемы стандартизированы 8 правил:
1. Приоритетнее адрес, совпадающий с адресом назначения
2. Приоритетнее адрес из подсети, вид которой более приближен к виду подсети назначения (scope)
3. Preferred-адрес приоритетнее deprecated-адреса
4. Домашний адрес приоритетнее дорожного (мобильность)
5. Приоритетнее адрес сетевого интерфейса, обращенного в сторону адреса назначения
6. Приоритетнее адрес, чья метка равна метке адреса назначения
7. Временный адрес приоритетнее постоянного
8. Приоритетнее адрес из подсети, которая имеет наиболее длинный общий префикс с подсетью назначения

Проверка адресов по происходит в порядке указания правил. Если победитель не
выявлен, то дальнейший выбор зависит от реализации

## 65. Поддержка мобильности в IPv6

Мобильные станции в отличие от стационарных могут перемещаться в пространстве,
это накладывает определенные сложности.

Мобильными обычно являются хосты.

Вводятся понятия home link, home address и home subnet prefix, а также
foreign link, care-of (дорожный) address  и foreign subnet prefix.

Если мобильный хост находится в чужом линке, то он регистрируется у своего
домашнего агента, который затем перенаправляет по туннелю трафик с домашнего
адреса на дорожный. Все обращение к мобильному хосту происходит по домашнему
адресу.

В IPv6 есть несколько составляющих реализующих поддержку мобильности:
- Mobility header
- Несколько видов ICMPv6-сообщений
- Дополнения Neighbor Discovery

## 66. Специальные соглашения при IPv6-адресации и IPv6-маршрутизации

Соглашения в области IPv6-адресации:
1. Unspecified `::/128` (адрес всех глобальных сетей)
2. Loopback `::1/128` (адрес сетевого интерфейса -- заглушки)

Изменения в маршрутизации. Специальные соглашения в IPv6-маршрутизации:
1. Маршрут по умолчанию `::/0`
2. Маршрут к большей чем линк подсети `X:...:X/N`, N < 64
3. Маршрут к подсети размером с линк `X:X:X:X/64`
4. Маршрут к одному сетевому интерфейсу `X:X:X:X:X:X:X:X/128`

*Предположительно этого мало, стоит написать ещё что-нибудь по адресации
или маршрутизации.*

## 67. Статическая и динамическая IPv6-адресация в Windows

Редакции Windows уже давно поддерживают IPv6.

Типовой хост имеет следующие адреса:
- Адрес Link-local Unicast
- Дополнительные адреса Unicast
- Loopback
- Адрес Link-local All Nodes Multicast
- Адреса Solicited-node Multicast для каждого из адресов Unicast
- Дополнительные групповые адреса Multicast

Автоконфигурирование работает даже при статическом конфигурировании адресов.

Для детальной настройки IPv6 адресации можно использовать команду
`netsh interface ipv6`. Однако также имеется и несколько графических форм
для их настройки.

Просмотреть IPv6 адреса можно через команду `ipconfig`.

## 68. Статическая и динамическая IPv6-адресация в Linux

Linux поддерживает IPv6 начиная с версии 2.2.

Типовой хост имеет следующие адреса:
- Адрес Link-local Unicast
- Дополнительные адреса Unicast
- Loopback
- Адрес Link-local All Nodes Multicast
- Адреса Solicited-node Multicast для каждого из адресов Unicast
- Дополнительные групповые адреса Multicast

Присвоение адресов IPv6 сводится к работе с соответствующими
конфигурационными файлами. В каждом дистрибутиве они находятся в разных
каталогах и имеют разные структуры. В Debian соответсвующий файл совпадает
с файлом для настройки IPv4 адресации `/etc/network/interfaces`.

Просмотреть IPv6 адреса можно через команды `ifconfig`, `ip address`.

Автоконфигурированием занимается демон radvd. Его конфигурационный файл
`/etc/radvd.conf`.

## 69. Статическая и динамическая IPv6-адресация в IOS

В IOS IPv6 возможности по умолчанию выключены.

Команда `ipv6 enable` включает поддержку IPv6 на интерфейсе и генерирует ему
Link-local Unicast адрес.

При использовании команды `ipv6 address` можно присвоить сетевому интерфейсу
юникаст адрес, неявно включает поддержку IPv6 и генерирует Link-local
Unicast адрес, если ранее он не имелся. При использовании аргумента `eui-64`
можно автоматически сгенерировать интерфейсную часть адреса. Аргумент
`link-local` позволяет заменить автоматически сгенерированный Link-local
Unicast адрес. Аргумент `anycast` позволяет добавить эникаст-адрес.

Для вывода информации используется команда `show ipv6 interface brief`.

По умолчанию маршрутизаторы работают в режиме IPv6-хоста, переход в режим
IPv6-маршрутизатора осуществляется командой `ipv6 unicast-routing`.

Для управления ND используют семейство команд `ipv6 nd`.

Запуск DHCPv6-клиента осуществляется командой `ipv6 address dhcp`.
Маршрутизатор может быть либо DHCPv6-клиентом, либо DHCPv6-сервером, либо
DHCPv6 relay.

## 70. Поддержка совместимости IPv6 с IPv4 в Windows, Linux и IOS

Поддержка совместимости IPv6 с IPv4 осуществляется путем туннелирования
IPv6-over-IPv4.

В последних версиях Windows по умолчанию запрещен туннельный интерфейс 6to4,
ISATAP (Intra-Site Automatic Tunnel Addressing Protocol) и Teredo.
Их можно включить изменив соответствующие параметры в реестре. Настройка
туннеля осуществляется через команду `netsh interface ipv6`.

С Linux с помощью демона radvd можно настроить интерфейс 6to4. С помощью
утилиты ip можно настроить ISATAP. Конфигурационный файл Teredo:
`/etc/miredo.conf`.

В IOS поддерживаются следующие режимы туннелирования IPv6-over-IPv4:
- Manual
- 6to4
- ISATAP

Конфигурация туннеля в IOS осуществляется после перехода в соответсвующий
режим командой `interface tunnel`. После можно использовать команду `tunnel`.

## 71. Таблицы IPv6-маршрутизации в Windows, Linux и IOS

Основными отличиями от IPv4 являются увеличение количества строк таблицы
маршрутизации и изменение набора полей.

В типовую таблицу маршрутизации включаются следующие маршруты:
- К своим подсетям размером с линк (для всех адресов Link-local Unicast, Unique Local Unicast, Global Unicast)
- К своим сетевым интерфейсам (для всех адресов Link-local Unicast, Unique Local Unicast, Global Unicast)
- Маршрут по умолчанию
- Маршрут к Loopback
- Маршруты, связанные с адресами Multicast
- Дополнительные статические и динамические маршруты
- Маршруты к туннелям IPv6-over-IPv4

Алгоритм выбора маршрута аналогичен оному в IPv4.

Чтобы посмотреть таблицу маршрутизации в Windows используют команду `route
print -6`, в Linux - `netstat -r -A inet6`, а в IOS - `show ipv6 route`.

## 72. Статическая IPv6-маршрутизация в Windows, Linux и IOS

Алгоритм выбора маршрута аналогичен оному в IPv4.

По умолчанию в системах IPv6 forwarding выключен. Чтобы его включить в
Windows можно использовать сервис `Routing and Remote Access` или утилиту
netsh, в Linux - конфигурационный файл `/etc/sysconfig/network`, а в IOS -
`ipv6 unicast-routing`.

Добавить статический маршрут в Windows можно командой `netsh interface
ipv6 add route`, в Linux - `route -A inet6 add`, а в IOS - `ipv6 route`.

## 73. Понятие прокси и место прокси в компьютерной сети

Прокси - совокупность программного и аппаратного обеспечения,
предназначенная для контроля доступа к сетевым ресурсам.

Задачи, выполняемые прокси:
- Аутентификация
- Фильтрация
- Сетевой экран (firewall)
- Кибербезопасность
- Логирование
- Отслеживание угроз (threat monitoring)
- Акселерация
- Формирование трафика (traffic shaping)
- Преобразование адресов (NAT)
- Преобразование информации (сжатие данных, балансировка нагрузки)

Типичное место расположения прокси - граница между внутренней сетью и сетью
публичного доступа. Задачи, связанные с обеспечением безопасности обычно
решают во внутренней сети. Провайдеры, в идеале, обеспечивают
беспрепятственное прохождение трафика.

## 74. Аутентификация и ее проявления в компьютерных сетях

Аутентификация - определение круга пользователей, имеющих права доступа к
сетевым ресурсам.

В рамках аутентификации можно выделить:
1. Идентификацию (назначение пользователям и ресурсам уникальных идентификаторов)
2. Собственно аутентификацию (обеспечение гарантии, что пользователи являются теми, за кого себя они выдают)
3. Авторизацию (название аутентифицированным пользователям прав)

Аутентификация обычно выполняется по учетной записи (account) т.е. по имени
пользователя и паролю. Может выполняться по совершенно разным идентификаторам:
от IP-адреса до биометрических данных.

Аутентификацию можно проводить:
- Локально (на том же устройстве к которому требуется доступ)
- Удаленно (запрос перенаправляется на специальный сервер)

## 75. Сетевые экраны и фильтрация трафика

Сетевой экран (firewall) - запрет/разрешение доступа к определенной группе
сетевых ресурсов.

Сетевой экран в основном выполняет фильтрацию.

Фильтрация - запер или разрешение прохождения входящих или исходящих пакетов
по выбранным критериям. В качестве объекта фильтрации выступает пакет.

Классификация сетевых экранов:
- Packet Firewall (пропускают или отбрасывают пакеты. Работают на третьем уровне)
- Stateful Firewall (выполняют инспекцию TCP трафика. Работают на третьем и четвертом уровнях)
- Application Gateway Firewall (выполняют глубокую инспекцию сообщений протоколов прикладного уровня. Работают с третьего и по седьмой уровни)

## 76. Защита информации, передаваемой по открытым сетям

Кибербезопасность - обеспечение защиты информации, передаваемой по открытым
для прослушивания сетям.

Задачи кибербезопасности:
- Аутентификация (обеспечение гарантии, что сообщение пришло от того, от кого его ожидают. Заключается в манипулировании с ключами)
- Целостность (обеспечение гарантии, что при пересылке сообщения оно не было повреждено или подменено. Заключается в подсчете хеш-функций)
- Конфиденциальность (обеспечение гарантии, что перехваченное сообщение не может быть прочитано. Заключается в шифровании данных)

Часто применяются цифровые подписи и цифровые сертификаты.

В последнее время для обеспечения безопасности часто используют VPN,
базирующийся на виртуальных частных каналах (по сути защищенные туннели).

При администрировании, существуют две политики обеспечения безопасности:
1. Разрешено все, что не запрещено
2. Запрещено все, что не разрешено

Более надежен второй подход.

## 77. Отслеживание и подавление угроз в компьютерных сетях

Среди задач прокси отдельно от логирования и безопасности выделяют
отслеживание угроз (threat monitoring).

По реакции при нахождении угроз прокси можно поделить на:
- Intrusion Detection Systems (проверяют трафик по сигнатурам на вредоносность с последующим оповещением при обнаружении. Обычно трафик не пропускается через них на прямую, а копируется)
- Intrusion Prevention Systems (не просто отслеживают вредоносный трафик, но и способны его заблокировать. Обычно трафик пропускается через них напрямую)

## 78. Примеры вредоносных атак в компьютерных сетях

Cisco выделяет три типа вредоносных атак:
- Разведывательные (цель: несанкционированный сбор информации. Примеры: сниферы, фишинг, социальная инженерия)
- Связанные с доступом (цель: получение несанкционированного доступа к информации или подмена информации. Примеры: подбор паролей методом грубой силы, перенаправление пользовательских запросов на ложные серверы, различные варианты подмены информации в каналах, использование уязвимостей ПО)
- Связанные с сервисами (цель: заставить машину/сеть зависнуть или отключиться, реализуется путем создания огромного необрабатываемого трафика, в связи с этим имеет продвинутую версию DDoS, в которой трафик создает множество устройств. Примеры: ping of death, smurf)

## 79. Примеры злоумышленников и вредоносных программ в компьютерных сетях

Cisco выделяет следующие типы компьютерных преступников:
- Hacker (наиболее общий термин, разбираются в компьютерных технологиях)
- Black Hat (злоумышленники, могут и не разбираться в том, что пытаются делать)
- White Hat (выполняют несанкционированные атаки не имея цели навредить, а наоборот, сообщить об уязвимости)
- Crackers (специализируются на взломе защиты КС или ПО)
- Spammers (массово рассылают электронную почту)
- War Drivers (обычно ищут незащищенные беспроводные сети)
- Phishers (пытаются под различными предлогами выудить конфиденциальную информацию)

Cisco выделяет три типа вредоносных программ:
- Вирус (наиболее общий термин, распространяются путем внедрения вредоносного кода в пользовательские программы)
- Червь (самостоятельное распространение по сети)
- Троянский конь (маскируются под безобидные программы)

![image](https://github.com/amateomi/aksis/assets/74430714/88409f51-8081-4529-b3fb-2383d06648e0)

## 80. Задачи прокси, непосредственно несвязанные с безопасностью

### Акселерация
Ускорение доступа к сетевым ресурсам за счет определенных оптимизаций.

Основные способы:
- Кеширование
- Многопоточность
- Поддержка докачки

### Формирование трафика
Распределение приоритетов при доступе к сетевым ресурсам по определенным
критериям. Может быть программным или аппаратным, статическим или
динамическим. Может осуществляться по разным критериям, например, по
времени.

### Преобразование адресов
Решает задачу, когда требуется, чтобы несколько станций из внутренней сети
могли совместно пользоваться одним публичным адресом. Крайне актуален для
IPv4 в связи с малым количеством IP адресов.

NAT (Network Address Translation) - наиболее общий стандарт, решающий
вышеописанную задачу путем прозрачной подмены адресов на маршрутизаторах.

### Прочие
Связаны с преобразованием передаваемой информации и не требующие обеспечения
конфиденциальности. Например, прозрачное сжатие данных, балансировку нагрузки.

## 81. NAT и другие манипуляции адресами

Задача: требуется, чтобы несколько станций из внутренней сети могли
совместно пользоваться одним публичным адресом.

NAT (Network Address Translation) - наиболее общий стандарт, решающий
вышеописанную задачу путем прозрачной подмены адресов на маршрутизаторах.

Алгоритм IP NAT:
1. Клиент передает пакет прокси с поддержкой NAT
2. Прокси запоминает IP-адрес назначения, IP-адрес источника, подставляет в качестве IP-адреса источника свой адрес и передает пакет серверу, запрашиваемому клиентом
3. После получения ответного пакета от сервера выполняются обратные преобразования на основе запомненной информации
4. Ответный пакет передается клиенту

NAT работает по табличному принципу. При чем в общем случае в обе стороны.

NAT делят на:
- Статический (преобразования осуществляется исходя из строгого соответствия пар адресов)
- Динамический (при преобразованиях адресА по мере надобности выделяются из пулов)

Статический NAT позволяет разместить во внутренней сети сервер и адресовать его из Internet.

IP-маскарад 🤡 - IP-адрес сетевого интерфейса можно менять на лету.

IP-aliasing - обобщенно означает, что сетевой интерфейс может иметь несколько
IP-адресов.

## 82. Пример взаимодействия через прокси

Типичное место расположения прокси -- это граница между внутренней сетью и
сетью публичного доступа.

Задачи, связанные с обеспечением безопасности обычно решают во
внутренней сети. Провайдеры, в идеале, обеспечивают беспрепятственное
прохождение трафика.

Касательно протоколов прикладного уровня, подавляющее большинство прокси -
это HTTP-прокси, причем двух вариантов:
- Get Method
- Connect Method (при TLS-туннелировании)

На втором месте находятся прокси электронной почты. Все остальные
встречаются крайне редко.

Последовательность взаимодействия клиента и сервера на примере HTTP-прокси:
1. Клиент посылает запрос на HTTP-прокси сервер
2. HTTP-прокси сервер перенаправляет запрос на сервер
3. HTTP-сервер отправляет запрошенные данные на HTTP-прокси сервер
4. HTTP-прокси возвращает запрашиваемые данные клиенту

HTTP-прокси может кешировать запросы, фильтровать и в общем случае выполнять
все задачи прокси.

